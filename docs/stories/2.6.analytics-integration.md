# Story 2.6: Analytics Integration

**Epic:** 2 - Homepage Core  
**Status:** Draft  
**Sprint:** 2 (Semanas 3-4)  
**Prioridade:** üî¥ Cr√≠tica

---

## Story

**As a** product owner,  
**I want** to track user behavior with GA4 and Meta Pixel,  
**so that** I can measure website performance and optimize conversion.

---

## Acceptance Criteria

1. GA4 configured and tracking pageviews
2. Meta Pixel configured and tracking PageView
3. CTA click events tracked
4. Analytics scripts load correctly
5. Events fire on correct user actions
6. No performance impact from analytics

---

## Tasks / Subtasks

- [ ] Task 1: Install Analytics Dependencies (AC: 1, 2)
  - [ ] Install `@next/third-parties`: `npm install @next/third-parties`
  - [ ] Verify package installed correctly

- [ ] Task 2: Configure GA4 (AC: 1, 4)
  - [ ] Add GA4 script to `app/layout.tsx`
  - [ ] Use Next.js Script component with strategy="afterInteractive"
  - [ ] Configure GA4 ID from environment variable
  - [ ] Implement pageview tracking
  - [ ] Test GA4 in development

- [ ] Task 3: Configure Meta Pixel (AC: 2, 4)
  - [ ] Add Meta Pixel script to `app/layout.tsx`
  - [ ] Use Next.js Script component
  - [ ] Configure Pixel ID from environment variable
  - [ ] Implement PageView tracking
  - [ ] Test Pixel in development

- [ ] Task 4: Create Analytics Helper (AC: 3, 5)
  - [ ] Create `lib/analytics.ts`
  - [ ] Implement GA4 event tracking function
  - [ ] Implement Meta Pixel event tracking function
  - [ ] Create helper for cta_click event

- [ ] Task 5: Implement CTA Click Tracking (AC: 3)
  - [ ] Update CTAFinal component
  - [ ] Add click handler with analytics tracking
  - [ ] Track GA4: `cta_click`
  - [ ] Test event fires correctly

- [ ] Task 6: Verify Analytics (AC: 1, 2, 3, 5, 6)
  - [ ] Test pageview tracking
  - [ ] Test CTA click tracking
  - [ ] Verify in GA4 real-time reports
  - [ ] Verify in Meta Pixel Events Manager
  - [ ] Check performance impact (Lighthouse)

---

## Dev Notes

### Previous Story Insights
[From Story 2.5]
- CTA Final section implemented
- CTA button ready for tracking

### GA4 Implementation
[Source: architecture/external-integrations.md - Section 7]

Implementation in `app/layout.tsx`:
```typescript
import Script from 'next/script';

<Script
  src={`https://www.googletagmanager.com/gtag/js?id=${process.env.NEXT_PUBLIC_GA_ID}`}
  strategy="afterInteractive"
/>
<Script id="google-analytics" strategy="afterInteractive">
  {`
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '${process.env.NEXT_PUBLIC_GA_ID}', {
      page_path: window.location.pathname,
    });
  `}
</Script>
```

**Events Tracked:**
- `page_view` (autom√°tico)
- `cta_click` (manual)

### Meta Pixel Implementation
[Source: architecture/external-integrations.md - Section 7]

Similar to GA4, script in `app/layout.tsx`:
```typescript
<Script id="facebook-pixel" strategy="afterInteractive">
  {`
    !function(f,b,e,v,n,t,s)...
    fbq('init', '${process.env.NEXT_PUBLIC_FB_PIXEL_ID}');
    fbq('track', 'PageView');
  `}
</Script>
```

**Events Tracked:**
- `PageView` (autom√°tico)
- `Lead` (future - form submission)

### Analytics Helper
[Source: architecture/source-tree.md]

Create `lib/analytics.ts` with:
- `trackGA4Event(eventName, parameters)`
- `trackMetaPixelEvent(eventName, parameters)`
- Type-safe event tracking

### Environment Variables
[Source: architecture/environment-variables.md]

Required:
- `NEXT_PUBLIC_GA_ID`: GA4 measurement ID (G-XXXXXXXXXX)
- `NEXT_PUBLIC_FB_PIXEL_ID`: Meta Pixel ID

### File Locations
[Source: architecture/source-tree.md]

- Analytics helper: `lib/analytics.ts`
- Layout: `app/layout.tsx`
- CTA component: `components/sections/CTAFinal.tsx`

### Performance Considerations
[Source: prd/requisitos-nao-funcionais.md]

- Use `strategy="afterInteractive"` for scripts
- Ensure analytics don't block page load
- Monitor performance impact

### Testing
[Source: architecture/testing-strategy.md]

**Testing Standards:**
- Test in GA4 real-time reports
- Test in Meta Pixel Events Manager
- Verify events fire correctly
- Check performance impact
- For this story: Manual testing sufficient

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | SM (Bob) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

---

## QA Results
_To be filled by QA Agent_

---

