# Story 4.5: Email Integration

**Epic:** 4 - Conversion Flow  
**Status:** Draft  
**Sprint:** 4 (Semanas 7-8)  
**Prioridade:** üî¥ Cr√≠tica

---

## Story

**As a** contact who submitted the form,  
**I want** to receive a confirmation email,  
**so that** I have a record of my submission and know what to expect.

---

## Acceptance Criteria

1. Resend/SendGrid configured
2. Email confirmation sent to contact after form submission
3. Email welcome sent to newsletter subscribers
4. HTML email templates are responsive
5. Emails include proper branding and content

---

## Tasks / Subtasks

- [ ] Task 1: Install Email Service (AC: 1)
  - [ ] Install Resend: `npm install resend`
  - [ ] Create Resend account and get API key
  - [ ] Add EMAIL_API_KEY to environment variables

- [ ] Task 2: Create Email Helper (AC: 1)
  - [ ] Create `lib/email.ts`
  - [ ] Initialize Resend client
  - [ ] Create email sending functions

- [ ] Task 3: Create Contact Confirmation Email (AC: 2, 4, 5)
  - [ ] Create email template
  - [ ] Subject: "Diagn√≥stico Agendado - Digital Dog"
  - [ ] HTML template with branding
  - [ ] Responsive design
  - [ ] Include preparation checklist

- [ ] Task 4: Create Newsletter Welcome Email (AC: 3, 4, 5)
  - [ ] Create email template
  - [ ] Subject: "Bem-vindo √† Digital Dog"
  - [ ] HTML template with branding
  - [ ] Responsive design

- [ ] Task 5: Integrate with API (AC: 2, 3)
  - [ ] Update /api/contact to send confirmation email
  - [ ] Update /api/newsletter to send welcome email (future)
  - [ ] Handle email errors gracefully

---

## Dev Notes

### Previous Story Insights
[From Story 4.3]
- Contact API endpoint created
- Contact saved to database

### Email Integration
[Source: architecture/external-integrations.md - Section 7]

Implementation:
```typescript
// lib/email.ts
import { Resend } from 'resend';

const resend = new Resend(process.env.EMAIL_API_KEY);

export async function sendContactConfirmation(contact: Contact) {
  await resend.emails.send({
    from: process.env.EMAIL_FROM!,
    to: contact.email,
    subject: 'Diagn√≥stico Agendado - Digital Dog',
    html: `...`,
  });
}
```

### Environment Variables
[Source: architecture/environment-variables.md]

- `EMAIL_API_KEY`: Resend API key
- `EMAIL_FROM`: Sender email address (e.g., "noreply@digitaldog.pet")

### Email Templates
[Source: architecture/external-integrations.md - Section 7]

Contact confirmation email should include:
- Thank you message
- Preparation checklist
- Next steps
- Contact information

### File Locations
[Source: architecture/source-tree.md]

- Email helper: `lib/email.ts`
- API route: `app/api/contact/route.ts`

### Testing
[Source: architecture/testing-strategy.md]

**Testing Standards:**
- Test email sending
- Test email templates render correctly
- Test responsive design in email clients
- For this story: Manual testing sufficient

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | SM (Bob) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

---

## QA Results
_To be filled by QA Agent_

---

