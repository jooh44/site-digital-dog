# Story 4.2: Calendly Integration

**Epic:** 4 - Conversion Flow  
**Status:** Draft  
**Sprint:** 4 (Semanas 7-8)  
**Prioridade:** ðŸ”´ CrÃ­tica

---

## Story

**As a** website visitor,  
**I want** to schedule a diagnostic appointment directly on the page,  
**so that** I can book a time slot without leaving the website.

---

## Acceptance Criteria

1. Calendly embed integrated inline on /diagnostico page
2. Calendly URL configured from environment variable
3. Responsive design (mobile-friendly)
4. Analytics tracking implemented (calendly_booking event)
5. Embed loads correctly and is functional

---

## Tasks / Subtasks

- [ ] Task 1: Create Calendly Component (AC: 1, 5)
  - [ ] Create `components/forms/CalendlyEmbed.tsx`
  - [ ] Implement Calendly inline widget
  - [ ] Load Calendly script dynamically
  - [ ] Configure data-url from environment variable

- [ ] Task 2: Configure Environment Variable (AC: 2)
  - [ ] Add `NEXT_PUBLIC_CALENDLY_URL` to .env.example
  - [ ] Document Calendly URL format
  - [ ] Update environment variables documentation

- [ ] Task 3: Integrate into DiagnÃ³stico Page (AC: 1)
  - [ ] Add CalendlyEmbed component to /diagnostico page
  - [ ] Position after form or in separate section
  - [ ] Ensure proper spacing

- [ ] Task 4: Implement Responsive Design (AC: 3)
  - [ ] Ensure embed is responsive
  - [ ] Test on mobile devices
  - [ ] Adjust min-width and height for mobile

- [ ] Task 5: Add Analytics Tracking (AC: 4)
  - [ ] Listen for Calendly events
  - [ ] Track GA4 event: `calendly_booking`
  - [ ] Track Meta Pixel event: `Schedule`
  - [ ] Test tracking in development

---

## Dev Notes

### Previous Story Insights
[From Story 4.1]
- DiagnÃ³stico page created
- Form component implemented

### Calendly Integration
[Source: architecture/external-integrations.md - Section 7]

Implementation:
```tsx
'use client';
import { useEffect } from 'react';

export default function CalendlyEmbed() {
  useEffect(() => {
    const script = document.createElement('script');
    script.src = 'https://assets.calendly.com/assets/external/widget.js';
    script.async = true;
    document.body.appendChild(script);
    
    return () => {
      document.body.removeChild(script);
    };
  }, []);

  return (
    <div
      className="calendly-inline-widget"
      data-url={process.env.NEXT_PUBLIC_CALENDLY_URL}
      style={{ minWidth: '320px', height: '700px' }}
    />
  );
}
```

### Environment Variable
[Source: architecture/environment-variables.md]

- `NEXT_PUBLIC_CALENDLY_URL`: Calendly scheduling page URL

### Analytics Events
[Source: architecture/external-integrations.md - Section 7]

GA4 Events:
- `calendly_booking` - Track when booking is completed

Meta Pixel Events:
- `Schedule` - Track scheduling event

### File Locations
[Source: architecture/source-tree.md]

- Component: `components/forms/CalendlyEmbed.tsx`
- Page: `app/diagnostico/page.tsx`

### Responsive Design
[Source: prd/requisitos-nao-funcionais.md]

- Mobile-first design
- Ensure embed works on all screen sizes
- Test on real devices

### Testing
[Source: architecture/testing-strategy.md]

**Testing Standards:**
- Test embed loads correctly
- Test booking flow
- Test analytics tracking
- Test responsive behavior
- For this story: Manual testing sufficient

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | SM (Bob) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

---

## QA Results
_To be filled by QA Agent_

---

